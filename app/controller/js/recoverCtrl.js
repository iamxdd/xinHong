/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("recoverCtrl",["$scope","$http","ngDialog","PagerExtends","layerAlert","serverUrls","PcService","$interval","$state",function(a,b,c,d,e,f,g,h,i){a.showError=!1,a.recover={},a.recover.phone="",a.first=!0,a.newp={},a.sendBtn=!0,a.sendValue="60秒后重新发送",a.isNull=function(a){return a?!1:!0},a.isFilter=function(a){return/^1[3|4|5|8][0-9]\d{4,8}$/.test(a.phone)?!1:!0},a.lazySend=function(){var b=60;h(function(){b>0?(b--,a.sendValue=b+"秒后重新发送"):(a.sendBtn=!1,a.sendValue="发送验证码")},1e3,60).then(function(){a.sendBtn=!1,a.sendValue="发送验证码"})},a.backToPre=function(){i.go("page.login")},a.sendPassward=function(){a.sendBtn=!0;var c=a.isNull(a.recover.phone),d=a.isNull(a.recover.name),h=a.isFilter(a.recover);return c||d?void e.autoclose("用户账号、手机号码不能为空！"):h?void e.autoclose("请输入正确的手机号码！"):void(a.listBusyPromise=b({method:"get",url:f.veriFicationcode+"?residentStatus="+a.recover.name+"&phone="+a.recover.phone}).success(function(b){var c=b.State.Code,d=b.State.Message;0===c?(e.autoclose("短信已发送，请注意查收！"),a.first=!a.first,a.lazySend()):e.autoclose(d)}).error(function(a){e.autoclose(g.errorResult(a))}))},a.submitForm=function(){if(a.sendBtn=!0,a.newp.phone=a.recover.phone,a.newp.residentStatus=a.recover.name,!a.newp.password||!a.newp.confirmationPwd||!a.newp.code)return void e.autoclose("验证码/密码不能为空！");var c=/^[a-zA-Z0-9]{1,16}$/;return c.test(a.newp.password)?a.newp.password!==a.newp.confirmationPwd?void e.autoclose("两次输入的密码不一致！"):void(a.listBusyPromise=b({method:"post",url:f.forgotPassword,data:a.newp}).success(function(a){var b=a.State.Code,c=a.State.Message;0===b?(e.autoclose("修改成功！"),setTimeout(function(){i.go("page.login")},1600)):e.autoclose(c)}).error(function(a){e.autoclose(g.errorResult(a))})):void e.autoclose("密码只能由数字和字母组成！")},a.reSendPassward=function(){a.sendBtn=!0,a.listBusyPromise=b({method:"get",url:f.veriFicationcode+"?residentStatus="+a.recover.residentStatus+"&phone="+a.recover.phone}).success(function(b){var c=b.State.Code,d=b.State.Message;0===c?a.lazySend():e.autoclose(d)}).error(function(a){e.autoclose(g.errorResult(a))})}}]);