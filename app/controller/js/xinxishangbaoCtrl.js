/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("xinxishangbaoCtrl",["$scope","$rootScope","$http","ngDialog","PagerExtends","layerAlert","serverUrls","PcService","$q",function(a,b,c,d,e,f,g,h,i){a.searchOption={value:"",usageLevel:0,isNeedBind:2},a.PcService=h,a.WokerFlowList=[],a.booleanToIcon=function(a){return a?"√":"×"},a.booleanClass=function(a){return{"color-success":a,"color-danger":!a}},a.VerifyStates=[{Id:0,Name:"未核实"},{Id:1,Name:"已核实"},{Id:2,Name:"核实不属实"}],a.isDisabled=function(a){var b=!1;return b=a.IsHandled?!0:!1},a.navTabList=[{Id:1,Name:"未核实",Active:!0},{Id:2,Name:"已核实",Active:!1},{Id:3,Name:"已处理",Active:!1},{Id:4,Name:"已立项",Active:!1}],a.selectTab=a.navTabList[0],a.checkedItem={};a.fieldsList=[[{name:"Name",nameDisplay:"事件名称",editor:"normal",required:!0,value:"",originValue:""},{name:"EventScope",nameDisplay:"事件范围",editor:"select",required:!0,value:"",originValue:0,opts:[{Id:0,Name:"信息上报"}]},{name:"WorkflowId",nameDisplay:"工作流模板",editor:"select",required:!0,value:"",originValue:""},{name:"Description",nameDisplay:"描述",editor:"normal",required:!1,value:"",originValue:""},{name:"Note",nameDisplay:"备注",editor:"normal",required:!1,value:"",originValue:""}],[{name:"GradePathName",nameDisplay:"位置信息",editor:"normal",required:!0,value:"",editable:!0}]];var j=function(b,d){a.listBusyPromise=c({method:"get",url:g.workflowList+"?currentPage=1&length=9999"}).success(function(c){var e=c.State.Code,g=c.State.Message;if(0===e){var h=c.Content.pagelist,i=[];if(h.forEach(function(a,b){1===a.OpenState&&i.push(a)}),a.WokerFlowList=i,0===a.WokerFlowList.length)return void f.autoclose("工作流列表暂无！");b.forEach(function(b,c){"WorkflowId"===b.name&&(b.opts=a.WokerFlowList,b.originValue=a.WokerFlowList[0].Id)}),d.resolve("success")}else f.autoclose(g)}).error(function(a){f.autoclose(h.errorResult(a))})};a.handleItem=function(c){var e=c.Name,f=i.defer(),k=f.promise,l=a.fieldsList[0];0===a.WokerFlowList.length?j(l,f):f.resolve("success"),k.then(function(){var f=a.WokerFlowList,i=a.fetchData;h.initFormList(l),l.forEach(function(a,b){return"Name"===a.name?void(a.value="对"+e+"的立项处理"):void 0}),d.openConfirm({template:"handleItem",controller:["$scope",function(a){a.fetchData=i,a.TitleText="立项处理",a.fieldsList=l,a.WokerFlowList=f,a.formSubmit=function(){var d={EventId:c.Id},e=h.getFormData(a.fieldsList).WorkflowId;a.WokerFlowList.forEach(function(a,b){return a.Id===e?void(d.WorkflowName=a.Name):void 0}),h.formSubmit(a,!0,a.fieldsList,g.ewSelector,null,d,b.pHeader)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},function(a){console.log(a)},function(a){console.log(a)})};var k=function(a,b){a.ngDialogPromise=c({method:"get",url:g.getDate+"?id="+b.OccurLocationId}).success(function(b){var c=b.State.Code,e=b.State.Message;return 0!==c?(f.autoclose(e),void setTimeout(function(){d.closeAll()},1e3)):void h.bindFormData(b.Content,a.fieldsList)}).error(function(a){f.autoclose(a+"")})};a.seeItem=function(b){var c=a.fieldsList[1];d.openConfirm({template:"_handleItem",controller:["$scope",function(a){a.fieldsList=c,a.detailInfo={},a.TitleText="地理位置信息",k(a,b)}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},a.checked=function(b){a.navTabList.forEach(function(a,c){a.Name===b.Name?a.Active=!0:a.Active=!1}),a.selectTab!==b&&(a.selectTab=b,a.fetchData())},a.fetchData=function(){var b={},c=g.eventfeedbackList;switch(a.selectTab.Id){case 1:b.verifyState=0;break;case 2:b.verifyState=1;break;case 3:b.isHandled=1;break;case 4:c=g.ewSelectorlist}b=$.extend(!0,b,a.searchOption),h.fetchData(a,c,b)},a.fetchData(a.selectTab.Id)}]);