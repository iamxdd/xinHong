/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("rolesCtrl",["$scope","$rootScope","$http","ngDialog","PagerExtends","layerAlert","serverUrls","PcService",function(a,b,c,d,e,f,g,h){a.list=[],a.TitleText="新增",a.fetchData=function(){a.listBusyPromise=c({headers:b.gHeader,method:"get",url:g.getAllRole}).success(function(b){var c=b.State.Code;b.State.Message;0===c&&(a.list=b.Content)}).error(function(a){f.autoclose(h.errorResult(a))})},a.fetchData(),a.creatOne=function(){var b=a.fetchData,c=a.fieldsList;h.initFormList(c),d.openConfirm({template:"createOne",controller:["$scope",function(a){a.TitleText="新增",a.fieldsList=c,a.fetchData=b,a.formSubmit=function(){h.formSubmit(a,!0,a.fieldsList,g.addRole)}}],className:"ngdialog-theme-default",closeByDocument:!1})},a.editItem=function(c){var e=a.fetchData,f=a.fieldsList;h.bindFormData(c,f),d.openConfirm({template:"createOne",controller:["$scope",function(a){a.TitleText="修改",a.fieldsList=f,a.fetchData=e,a.formSubmit=function(){h.formSubmit(a,!1,a.fieldsList,g.upRole,c,null,b.pHeader)}}],className:"ngdialog-theme-default",closeByDocument:!1})};var i=function(a,d){a.ngDialogPromise=c({headers:b.gHeader,method:"get",url:g.newMenurolelist+"?roleCode="+d.Code}).success(function(b){var c=b.State.Code;b.State.Message;0===c&&(a.AllMenus=b.Content.DTOMenu,a.AllMenus.forEach(function(a,b){var c=[{Name:"list",Check:!1},{Name:"add",Check:!1},{Name:"update",Check:!1},{Name:"detele",Check:!1},{Name:"openstate",Check:!1},{Name:"reviewstate",Check:!1}];if(a.Operation&&a.Operation.length>0){var d=a.Operation.split(",");c.forEach(function(a,b){d.forEach(function(b,c){return a.Name===b?void(a.Checked=!0):void 0})}),a.AllDoPermission=c}else a.AllDoPermission=c}))}).error(function(a){f.autoclose(h.errorResult(a))})},j=function(a,d,e){var j,k,l;if(d.Flag){var m="";d.AllDoPermission.forEach(function(a){a.Checked&&(m+=a.Name+",")}),m=m.substring(0,m.length-1),d.Id?(k="put",j=g.upStreetmenurole,l={Id:d.Id,RoleCode:e.Code,SrreetMenuCode:d.StreetMenuCode,Operation:m}):(k="post",j=g.inStreetmenurole,l={RoleCode:e.Code,SrreetMenuCode:d.StreetMenuCode,Operation:m})}else k="delete",j=g.deStreetmenurole+"?id="+d.Id,l=null;a.ngDialogPromise=c({headers:b.pHeader,method:k,url:j,data:l}).success(function(b){var c=b.State.Code;b.State.Message;0===c&&(f.autoclose("权限配置操作成功！"),i(a,e))}).error(function(a){f.autoclose(h.errorResult(a))})};a.configItem=function(b){var c=a.fetchData;d.openConfirm({template:"configOne",controller:["$scope",function(a){a.fetchData=c,a.roleName=b.Name,a.AllMenus=[],a.RoleMenus=[],a.AllDoPermission=[],i(a,b),a.showChildPermission=function(a){},a.saveMenuPermession=function(c){j(a,c,b)},a.saveAll=function(b){b.forEach(function(b){a.saveMenuPermession(b)})}}],className:"ngdialog-theme-default",closeByDocument:!1,width:960})},a.fieldsList=[{name:"Name",nameDisplay:"角色名称",editor:"normal",required:!0,value:"",originValue:""},{name:"Code",nameDisplay:"角色Code",editor:"normal",required:!0,value:"",originValue:""},{name:"Description",nameDisplay:"角色描述",editor:"normal",required:!1,value:"",originValue:""}]}]);