/*!qinglongWeb-1.0.0 2017-09-21*/
App.controller("schouseInfoCtrl",["$scope","$http","ngDialog","PagerExtends","layerAlert","serverUrls","PcService","$filter",function(a,b,c,d,e,f,g,h){a.list=[],a.navList=[{Id:1,Name:"按类型统计",Checked:!0},{Id:2,Name:"按位置统计",Checked:!1},{Id:3,Name:"按上报人统计",Checked:!1},{Id:4,Name:"按核实人统计",Checked:!1}],a.States=[{Id:1,Name:"按年查询"},{Id:2,Name:"按月查询"}],a.titles=[{Id:1,Name:"流动人口"},{Id:2,Name:"环境卫生"},{Id:3,Name:"纠纷调解"},{Id:4,Name:"重点人群"}],a.searchOption={state:1,startTime:h("date")(new Date,"yyyy-MM-dd"),endTime:h("date")(new Date,"yyyy-MM-dd")},a.selectedItem=a.navList[0];var i=document.getElementById("myEcharts"),j=echarts.init(i),k=function(b,c){var d=[],e=[],f=[];switch(b){case 1:c.forEach(function(a,b){a.DTODateAt.forEach(function(a,c){0===b&&(e.push([]),f.push(a.DateAt))}),a.DTODateAt.forEach(function(a,b){e[b].push(a.Count)}),d[b]=a.Type});break;case 2:c.forEach(function(a,b){a.DTODateAt.forEach(function(a,c){0===b&&(e.push([]),f.push(a.DateAt))}),a.DTODateAt.forEach(function(a,b){e[b].push(a.Count)}),d[b]=a.Name});break;case 3:c.forEach(function(a,b){a.DTODateAt.forEach(function(a,c){0===b&&(e.push([]),f.push(a.DateAt))}),a.DTODateAt.forEach(function(a,b){e[b].push(a.Count)}),d[b]=a.Name});break;case 4:c.forEach(function(a,b){a.DTODateAt.forEach(function(a,c){0===b&&(e.push([]),f.push(a.DateAt))}),a.DTODateAt.forEach(function(a,b){e[b].push(a.Count)}),d[b]=a.Name})}1===b&&d.forEach(function(b,c){d[c]=g.numberToText(d[c],a.titles)}),a.xAxisArray=d,a.seriesArray=e,a.seriesNames=f;var h={title:{text:"基础资源库统计",subtext:"重点人群、关注人群"},grid:{left:"1%",right:"1%",bottom:"5%",containLabel:!0},legend:{data:[]},toolbox:{feature:{saveAsImage:{show:!0},magicType:{show:!0,type:["line","bar"]}}},calculable:!0,xAxis:[{type:"category",data:d,axisLabel:{interval:0}}],yAxis:[{type:"value"}],series:[]};f.forEach(function(a,b){var c={name:f[b],type:"bar",data:e[b]};h.series.push(c)}),j.setOption(h,!0)};a.fetchData=function(){var c={type:a.selectedItem.Id};c=$.extend(!0,c,a.searchOption);var d=f.infostatistic,h="?";if(c){for(var i in c)h+=i+"="+c[i]+"&";d+=h.substring(0,h.length-1)}a.listBusyPromise=b({method:"get",url:d}).success(function(b){var c=b.State.Code;b.State.Message;0===c&&(a.list=b.Content,k(a.selectedItem.Id,a.list))}).error(function(a){e.autoclose(g.errorResult(a))})},a.fetchData(),a.setState=function(b){a.fetchData()},a.CheckItem=function(b){a.navList.forEach(function(a,c){a.Checked=!1,a.Id===b.Id&&(a.Checked=!0)}),a.selectedItem=b,a.fetchData()},$("#datetimeStart").datetimepicker({language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:4,maxView:4,forceParse:0,format:"yyyy-mm-dd",showMeridian:1}).on("click",function(a){$("#datetimeStart").datetimepicker()}),$("#datetimeEnd").datetimepicker({language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:4,maxView:4,forceParse:0,format:"yyyy-mm-dd",showMeridian:1}).on("click",function(a){$("#datetimeEnd").datetimepicker()})}]);