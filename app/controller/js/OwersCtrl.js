/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("OwersCtrl",["$scope","$rootScope","$http","ngDialog","PagerExtends","layerAlert","serverUrls","PcService",function(a,b,c,d,e,f,g,h){a.list=[],a.OwnerTypes=[],a.searchOption={value:""},a.fieldsList=[{name:"Name",nameDisplay:"名称",editor:"normal",required:!0,value:"",originValue:""},{name:"OwnerTypeId",nameDisplay:"拥有者类型",editor:"select",required:!0,value:"",originValue:"",opts:a.OwnerTypes},{name:"OwnerCode",nameDisplay:"拥有者Code",editor:"normal",required:!1,value:"",originValue:""},{name:"Description",nameDisplay:"描述",editor:"normal",required:!1,value:"",originValue:""},{name:"Note",nameDisplay:"备注",editor:"normal",required:!1,value:"",originValue:""}],a.creatOne=function(){var c=a.fieldsList,e=a.fetchData;h.initFormList(c),d.openConfirm({template:"createOne",controller:["$scope",function(a){a.fetchData=e,a.fieldsList=c,a.TitleText="新增拥有者",a.formSubmit=function(){h.formSubmit(a,!0,a.fieldsList,g.inEventowner,null,null,b.pHeader)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},a.editItem=function(c){var e=a.fieldsList,f=a.fetchData;h.bindFormData(c,e),d.openConfirm({template:"createOne",controller:["$scope",function(a){a.fetchData=f,a.fieldsList=e,a.TitleText="编辑拥有者",a.formSubmit=function(){h.formSubmit(a,!1,a.fieldsList,g.inEventowner,c,null,b.pHeader)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},a.deleteItem=function(c){f.checkone("删除操作",function(){h.deleteItem(a,g.inEventowner,c,b.pHeader)},function(){},"确定","取消",!0,!0,"确定要删除吗？")};var i=function(b,d){a.listBusyPromise=c({method:"get",url:g.eventownertypeList+"?length=9999&currentPage=1"}).success(function(c){var e=c.State.Code;c.State.Message;0===e&&(b&&d?(b.OwnerTypes=c.Content.pagelist,d.Members=c.Content.pagelist):(a.OwnerTypes=c.Content.pagelist,a.fieldsList.forEach(function(b,c){"OwnerTypeId"===b.name&&(b.opts=a.OwnerTypes,b.originValue=a.OwnerTypes[0].Id)}),h.fetchData(a,g.eventownerList)))}).error(function(a){f.autoclose(a.Message?a.Message:a+"")})};a.fetchData=function(){0===a.OwnerTypes.length?i():h.fetchData(a,g.eventownerList,a.searchOption)},a.fetchData();var j=function(d,e,j){a.ngDialogPromise=c({headers:b.pHeader,method:"delete",url:g.eventownerType+"?id="+j.Id}).success(function(a){var b=a.State.Code,c=a.State.Message;0===b?(f.autoclose("删除操作成功！"),i(d,e)):f.autoclose(c)}).error(function(a){f.autoclose(h.errorResult(a))})},k=function(a,b,d,e,g,j){a.ngDialogPromise=c({headers:e,method:"post",url:b,data:d}).success(function(b){var c=b.State.Code,d=b.State.Message;0===c?(f.autoclose("新增成功！"),i(g,j),a.closeThisDialog()):f.autoclose(d)}).error(function(a){f.autoclose(h.errorResult(a))})},l=function(a,c,e){var f=c,i=[{name:"Name",nameDisplay:"名称",editor:"normal",required:!0,value:""},{name:"Description",nameDisplay:"描述",editor:"normal",required:!1,value:""},{name:"Note",nameDisplay:"备注",editor:"normal",required:!1,value:""}];d.openConfirm({template:"createOne",controller:["$scope",function(c){c.fieldsList=i,c.TitleText="新增拥有者类型",c.formSubmit=function(){var d=h.getFormData(c.fieldsList);k(c,g.eventownerType,d,b.pHeader,a,f)},c.getResidentStatus=function(){getResidentStatus(c,c.Resident.value)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})};a.owerTypes=function(){var b=a;d.openConfirm({template:"owerTypesManage",controller:["$scope",function(a){a.TitleText="拥有者类型管理",a.Members=b.OwnerTypes,a.deleteMember=function(c){j(b,a,c)},a.createMember=function(c){l(b,a,c)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})}}]);