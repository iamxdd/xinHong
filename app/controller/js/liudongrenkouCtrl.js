/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("liudongrenkouCtrl",["$scope","$q","$rootScope","$http","$filter","ngDialog","PagerExtends","layerAlert","serverUrls","PcService",function(a,b,c,d,e,f,g,h,i,j){a.list=[],a.TitleText="新增",a.PcService=j,a.searchOption={population:2},a.CourtyardList=a.BuildingList=a.UnitList=a.FloorList=a.HouseList=[{Id:0,Name:"请选择"}];var k=function(b){b.forEach(function(b,c){"four-select"===b.editor&&(b.value1=a.CourtyardList[0].Id,b.opts1=a.CourtyardList,b.value2=a.BuildingList[0].Id,b.opts2=a.BuildingList)})},l=function(b){a.listBusyPromise=d({method:"get",url:i.courtyardAllList}).success(function(c){var d=c.State.Code,e=c.State.Message;0===d?(a.CourtyardList=c.Content,a.CourtyardList.forEach(function(a,b){a.Location.forEach(function(a,b){a.Location.forEach(function(a,b){var c=[];a.Location.forEach(function(a,b){c=c.concat(a.Location)}),a.Location=c})})}),a.BuildingList=a.BuildingList.concat(a.CourtyardList[0].Location),a.UnitList=a.UnitList.concat(a.BuildingList[1].Location),a.HouseList=a.HouseList.concat(a.UnitList[0].Location),b&&b.resolve("success")):h.autoclose(e)}).error(function(a){h.autoclose(j.errorResult(a))})},m=function(b){b.forEach(function(b,c){"four-select"===b.editor?(b.value2=b.value3=b.value4=b.originValue,b.opts2=a.BuildingList,b.opts3=b.opts4=[{Id:0,Name:"请选择"}]):b.value=b.originValue})},n=function(a){a.forEach(function(a,b){if("select"===a.editor&&0===a.opts[0].Id){var c=[];a.opts.forEach(function(a,b){a.Id>0&&c.push(a)}),a.opts=c,a.originValue=c[0].Id}})};a.creatOne=function(){a.fieldsList.forEach(function(a,b){a.editable=!1});var d=b.defer(),e=d.promise;a.CourtyardList&&a.CourtyardList.length>1?d.resolve():l(d),e.then(function(){var b=a.fieldsList,d=a.fetchData;k(b),n(b),m(b),f.openConfirm({template:"createOne",controller:["$scope",function(a){a.fieldsList=b,a.TitleText="新增",a.fetchData=d,a.formSubmit=function(){var b={Population:2};j.formSubmit(a,!0,a.fieldsList,i.addResident,null,b,c.pHeader)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:850})})};var o=function(a){f.openConfirm({template:"createOne",controller:["$scope",function(b){b.fieldsList=a,b.TitleText="查看",b.formSubmit=function(){f.closeAll()}}],className:"ngdialog-theme-default",closeByDocument:!1,width:850})},p=function(b,c,e){a.ngDialogPromise=d({method:"get",url:i.getSuperior+"?id="+b+"&type=4"}).success(function(a){var d=a.State.Code,f=a.State.Message;if(0===d){var g=a.Content,i=g.CourtyardId,j=g.BuildingId,k=g.UnitId;c.value1=i,c.opts1.forEach(function(a,d){a.Location.forEach(function(d,e){d.Id===j&&(c.opts2=a.Location,c.value2=j,c.opts2.forEach(function(a,d){a.Location.forEach(function(d,e){d.Id===k&&(c.opts3=a.Location,c.value3=k,c.opts3.forEach(function(a,d){a.Location.forEach(function(d,e){d.Id===b&&(c.opts4=a.Location,c.value4=b)})}))})}))})}),o(e)}else h.autoclose(f)}).error(function(a){h.autoclose(j.errorResult(a))})},q=function(b,c){c.forEach(function(d,e){if("four-select"===d.editor){d.opts1=a.CourtyardList,d.value4=b[d.name];var f=d.value4;p(f,d,c)}else d.value=b[d.name]})};a.editItem=function(c){a.fieldsList.forEach(function(a,b){a.editable=!0});var d=a.fieldsList,e=b.defer(),f=e.promise;a.CourtyardList&&a.CourtyardList.length>1?e.resolve():l(e),f.then(function(){q(c,d)})},a.Nations=[{Id:0,Name:"全部"},{Id:1,Name:"汉族"},{Id:2,Name:"藏族"},{Id:3,Name:"彝族"},{Id:4,Name:"其他少数民族"}],a.Sexes=[{Id:0,Name:"全部"},{Id:1,Name:"男"},{Id:2,Name:"女"}],a.MaritalStatus=[{Id:0,Name:"全部"},{Id:1,Name:"未婚"},{Id:2,Name:"已婚"},{Id:3,Name:"离异"},{Id:4,Name:"丧偶"}],a.SocialSecurityStatus=[{Id:0,Name:"全部"},{Id:1,Name:"有"},{Id:2,Name:"无"}],a.ResidencePermit=[{Id:0,Name:"全部"},{Id:1,Name:"有"},{Id:2,Name:"无"}],a.screenfields=[{nameDisplay:"关键字",name:"name",value:"",editor:"normal"},{nameDisplay:"性别",name:"sex",value:a.Sexes[0].Id,editor:"select",opts:a.Sexes},{nameDisplay:"民族",name:"nationality",value:a.Nations[0].Id,editor:"select",opts:a.Nations},{nameDisplay:"婚姻状态",name:"marital",value:a.MaritalStatus[0].Id,editor:"select",opts:a.MaritalStatus},{nameDisplay:"社保状态",name:"socialSecurity",value:a.SocialSecurityStatus[0].Id,editor:"select",opts:a.SocialSecurityStatus},{nameDisplay:"居住证",name:"residencepermit",value:a.ResidencePermit[0].Id,editor:"select",opts:a.ResidencePermit},{nameDisplay:"年齡",name1:"min",name2:"max",editor:"double-input",value1:"",value2:""}],a.fieldsList=[{name:"HouseId",nameDisplay:"房屋信息",editor:"four-select",required:!0,opts1:a.CourtyardList,opts2:a.BuildingList,opts3:a.UnitList,opts4:a.HouseList,value1:"",value2:"",value3:"",value4:"",column:1,originValue:0},{name:"Name",nameDisplay:"姓名",editor:"normal",required:!0,value:"",originValue:""},{name:"Sex",nameDisplay:"性别",editor:"select",required:!0,value:"",opts:a.Sexes,originValue:a.Sexes[0].Id},{name:"IDCardNo",nameDisplay:"身份证",editor:"normal",required:!0,value:"",originValue:""},{name:"Nationality",nameDisplay:"民族",editor:"select",required:!1,value:"",opts:a.Nations,originValue:a.Nations[0].Id},{name:"DomicilePlace",nameDisplay:"户籍所在地",editor:"normal",required:!1,value:"",originValue:""},{name:"Phone",nameDisplay:"联系电话",editor:"normal",required:!1,value:"",originValue:""},{name:"CurrentAddress",nameDisplay:"现居住地",editor:"normal",required:!1,value:"",originValue:""},{name:"ResidencePermit",nameDisplay:"居住证",editor:"select",required:!1,value:"",opts:a.ResidencePermit,originValue:a.ResidencePermit[0].Id},{name:"SocialSecurity",nameDisplay:"社保状态",editor:"select",required:!1,value:"",opts:a.SocialSecurityStatus,originValue:a.SocialSecurityStatus[0].Id},{name:"MaritalStatus",nameDisplay:"婚姻状态",editor:"select",required:!1,value:"",opts:a.MaritalStatus,originValue:a.MaritalStatus[0].Id}],a.getFetchData=function(){var b={};return a.screenfields.forEach(function(a,c){"double-input"===a.editor?(b[a.name1]=a.value1,b[a.name2]=a.value2):b[a.name]=a.value}),b},a.fetchData=function(){var b=$.extend(!0,a.searchOption,a.getFetchData());g.regListSpecifyPage(a,{apiUrl:i.populationlist,params:b,success:function(b){a.list=b;var c=new Date;a.list.forEach(function(a,b){a.Age=(c-new Date(a.BirthDate))/31536e6,a.Age<1?a.Age=Math.ceil(12*a.Age)+"月":a.Age=Math.floor(a.Age)+"岁",null==a.BirthDate&&(a.Age="无")})},error:function(a){h.autoclose(a)}})},a.fetchData(),a.formSubmit=function(){h.autoclose("您点击了提交表单!")}}]);