/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("projectsCtrl",["$scope","$http","ngDialog","PagerExtends","layerAlert","serverUrls","PcService","$q",function(a,b,c,d,e,f,g,h){a.list=[],a.searchOption={code:""},a.PcService=g,a.Forceupdates=[{Id:"true",Name:"是"},{Id:"false",Name:"否"}],a.newTite="版本号",a.navTabList=[{Id:1,Name:"版本号管理",Active:!0},{Id:2,Name:"APP类型",Active:!1}],a.selectTab=a.navTabList[0],a.checked=function(b){a.navTabList.forEach(function(a,c){a.Name===b.Name?a.Active=!0:a.Active=!1}),a.selectTab!==b&&(a.selectTab=b,1===b.Id?a.newTite="版本号":a.newTite="版本类型",a.fetchData())},a.fieldsList=[[{name:"VersionNo",nameDisplay:"版本号",editor:"normal",required:!0,value:"",originValue:""},{name:"DeviceTypeId",nameDisplay:"版本类型",editor:"select",required:!0,value:"",originValue:""},{name:"DownloadUrl",nameDisplay:"下载地址",editor:"normal",required:!0,value:"",originValue:""},{name:"Forceupdate",nameDisplay:"强制更新",editor:"select",required:!0,value:"",originValue:"false",opts:a.Forceupdates},{name:"Descript",nameDisplay:"描述",editor:"normal",required:!1,value:"",originValue:""}],[{name:"Name",nameDisplay:"类型名称",editor:"normal",required:!0,value:"",originValue:""},{name:"Code",nameDisplay:"类型识别码",editor:"normal",required:!1,value:"",originValue:""}]],a.fetchData=function(){switch(a.selectTab.Id){case 1:url=f.versionList;break;case 2:url=f.deviceTypelist}g.fetchData(a,url,a.searchOption)},a.fetchData();var i=function(a,c,d){a.listBusyPromise=b({method:"get",url:f.deviceTypelist+"?length=999&currentPage=1"}).success(function(b){var f=b.State.Code,g=b.State.Message;if(0===f){var h=b.Content.pagelist;if(0===h.length)return void e.autoclose("版本类型为空，请先新建版本类型！");a.fieldsList[0].forEach(function(a,b){a.name===c&&(a.opts=h,a.originValue=h[0].Id)}),d&&d.resolve()}else e.autoclose(g)}).error(function(a){e.autoclose(g.errorResult(a))})};a.creatOne=function(){if(1===a.selectTab.Id){var b=h.defer();i(a,"DeviceTypeId",b);var d=b.promise;d.then(function(){c.openConfirm({template:"createOne",scope:a,controller:["$scope",function(a){a.TitleText="新增版本号",a.fieldsList=a.$parent.$parent.fieldsList[0],g.initFormList(a.fieldsList),a.formSubmit=function(){g.formSubmit(a,!0,a.fieldsList,f.addVersion)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},function(a){console.log(a)},function(a){console.log(a)})}else c.openConfirm({template:"createOne",scope:a,controller:["$scope",function(a){a.TitleText="新增App类型",a.fieldsList=a.$parent.$parent.fieldsList[1],g.initFormList(a.fieldsList),a.formSubmit=function(){g.formSubmit(a,!0,a.fieldsList,f.adddEvictype)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},a.editItem=function(b){if(1===a.selectTab.Id){var d=h.defer();i(a,"DeviceTypeId",d);var e=d.promise;e.then(function(){c.openConfirm({template:"createOne",scope:a,controller:["$scope",function(a){a.TitleText="修改版本号",a.fieldsList=a.$parent.$parent.fieldsList[0],g.bindFormData(b,a.fieldsList),a.formSubmit=function(){g.formSubmit(a,!1,a.fieldsList,f.updateVersion,b)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},function(a){console.log(a)},function(a){console.log(a)})}else c.openConfirm({template:"createOne",scope:a,controller:["$scope",function(a){a.TitleText="修改App类型",a.fieldsList=a.$parent.$parent.fieldsList[1],g.bindFormData(b,a.fieldsList),a.formSubmit=function(){g.formSubmit(a,!1,a.fieldsList,f.updEvictype,b)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})}}]);