/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("homeCtrl",["$scope","$rootScope","$http","ngDialog","serverUrls","layerAlert","PcService","$filter",function(a,b,c,d,e,f,g,h){function i(){p=new BMap.Map("map"),p.centerAndZoom(new BMap.Point(104.120987,30.704218),19)}function j(){p.enableScrollWheelZoom(),p.enableKeyboard(),p.enableDragging(),p.enableDoubleClickZoom()}function k(){}function l(){var a=new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});a.setUnit(BMAP_UNIT_IMPERIAL),p.addControl(a);var b=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:1});p.addControl(b);var c=new BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:!1});p.addControl(c)}function m(){i(),j(),l(),k()}function n(a){this.backgroundColor=a.backgroundColor||"#fff",this.color=a.color||["#38a8da","#d4effa"],this.fontSize=a.fontSize||12,this.domEle=a.domEle,this.value=a.value,this.name=a.name,this.title=a.title}function o(){var a,b,c,d=new Date;switch(b=d.getFullYear(),c=d.getMonth()+1){case 1:case 2:case 3:case 4:case 5:c+=7,b--;break;default:c-=5}return c=10>c?"0"+c:c,a=b+"-"+c}var p;m(),a.listData=[],a.listIntegerData=[],a.Obtain=0,a.sumPeple=0,a.sumMatterCount=0,b.integralAarr=[],b.disposematterRate="0",b.disposematterDone=0,a.PcService=g,a.scheduleData=function(){var d={currentPage:1,length:9,verify:!1,history:!1},h=e.myWorkers,i="?";if(d){for(var j in d)i+=j+"="+d[j]+"&";h+=i.substring(0,i.length-1)}a.todoListPromise=c({headers:b.gHeader,method:"get",url:h}).success(function(b){var c=b.State.Code;0===c&&(a.listData=b.Content.pagelist)}).error(function(a){f.autoclose(g.errorResult(a))})},a.scheduleData(),a.obtainpointData=function(){a.listBusyPromise=c({method:"get",url:e.obtainPoint}).success(function(b){var c=b.State.Code;0===c&&(a.Obtain=b.Content)}).error(function(a){f.autoclose(g.errorResult(a))})},a.obtainpointData(),a.sumResidentData=function(){a.listBusyPromise=c({method:"get",url:e.sumResident}).success(function(b){var c=b.State.Code;0===c&&(a.sumPeple=b.Content)}).error(function(a){f.autoclose(g.errorResult(a))})},a.sumResidentData(),a.sumMatterData=function(){a.listBusyPromise=c({method:"get",url:e.sumMatter}).success(function(b){var c=b.State.Code;0===c&&(a.sumMatterCount=b.Content)}).error(function(a){f.autoclose(g.errorResult(a))})},a.sumMatterData();var q,r={value:0,backgroundColor:null,color:["#38a8da","#d4effa"],fontSize:16,domEle:document.getElementById("pieDiagram")};a.disposematterData=function(){a.listBusyPromise=c({method:"get",url:e.disposeMatter}).success(function(a){var c=a.State.Code;0===c&&(b.disposematterRate=a.Content.ProcessingRate.replace("%",""),b.disposematterDone=a.Content.Count,r.value=b.disposematterRate,q=new n(r),q.init())}).error(function(a){f.autoclose(g.errorResult(a))})},a.disposematterData(),n.prototype.init=function(){var a=this,b={backgroundColor:a.backgroundColor,color:a.color,title:{text:a.title,top:"3%",left:"1%",textStyle:{color:"#333",fontStyle:"normal",fontWeight:"normal",fontFamily:"sans-serif",fontSize:16}},series:[{name:"来源",type:"pie",radius:["60%","75%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center",textStyle:{fontSize:a.fontSize,fontWeight:"bold"},formatter:"{b}\n{c}%"}},data:[{value:a.value,name:a.name,label:{normal:{show:!0}}},{value:100-a.value,name:""}]}]};echarts.init(a.domEle).setOption(b)},a.integralData=function(){var d,h=o(),i=new Date,j=i.getFullYear(),k=i.getMonth()+1;k=10>k?"0"+k:k,d=j+"-"+k;var l={type:"1",startTime:h,endTime:d,state:"2"},m=e.pointStatistics,n="?";if(l){for(var p in l)n+=p+"="+l[p]+"&";m+=n.substring(0,n.length-1)}a.listBusyPromise=c({method:"get",url:m}).success(function(c){var d=c.State.Code;if(0===d){a.listIntegerData=c.Content,a.ObtainArr=[],a.ConsumeArr=[];var e=[];$(a.listIntegerData).each(function(b,c){var d=c.DateAt.split("-")[1]+"月",f=[d,c.Obtain],g=[d,c.Consume];a.ObtainArr.push(f),a.ConsumeArr.push(g),e.push(c.Obtain),e.push(c.Consume)}),b.integralAarr.push({label:"发放积分数",color:"#768294",data:a.ObtainArr}),b.integralAarr.push({label:"消耗积分数",color:"#1f92fe",data:a.ConsumeArr}),b.Ymax=Math.max.apply(null,e)}}).error(function(a){f.autoclose(g.errorResult(a))})},a.integralData(),a.weaterData=function(){c.jsonp("http://wthrcdn.etouch.cn/weather_mini?city=成都&output=json&ak=tQydkkwXfEtSNgvAEHUr1v6u0GbXUvZo&callback=JSON_CALLBACK").success(function(b){var c=b.data;a.forecast=c.forecast,a.weatherLogType=a.forecast[0].type;var d=new Date;a.forecast.forEach(function(a,b){a.date=new Date(d.getTime()+24*b*3600*1e3),a.low=a.low.substring(3,7),a.high=a.high.substring(3,7)})}).error(function(a){f.autoclose(g.errorResult(a))})},a.weaterData(),a.weathers=[{type:"阴",sty:"wi wi-cloudy"},{type:"小雨",sty:"wi wi-day-rain-mix"},{type:"中雨",sty:"wi wi-day-rain-wind"},{type:"大雨",sty:"wi wi-day-rain"},{type:"晴",sty:"wi wi-day-sunny"},{type:"多云",sty:"wi wi-day-cloudy"}],a.weatherClass=function(b){var c;return a.weathers.forEach(function(a,d){a.type===b.type&&(c=a.sty)}),c},a.weatherLogoArr=[{type:"阴",sty:"cloudy"},{type:"小雨",sty:"rain"},{type:"中雨",sty:"rain"},{type:"大雨",sty:"sleet"},{type:"晴",sty:"clear-day"},{type:"多云",sty:"partly-cloudy-day"}]}]);