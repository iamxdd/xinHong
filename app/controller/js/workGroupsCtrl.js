/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("workGroupsCtrl",["$scope","$rootScope","$http","ngDialog","PagerExtends","layerAlert","serverUrls","PcService","$q",function(a,b,c,d,e,f,g,h,i){a.list=[],a.TitleText="新增",a.searchOption={value:""},a.fieldsList=[{name:"Name",nameDisplay:"名称",editor:"normal",required:!0,value:"",originValue:""},{name:"Description",nameDisplay:"描述",editor:"normal",required:!1,value:"",originValue:""},{name:"Note",nameDisplay:"备注",editor:"normal",required:!1,value:"",originValue:""}],a.fetchData=function(){h.fetchData(a,g.workFlowgroups,a.searchOption)},a.fetchData(),a.creatOne=function(){var c=a.fieldsList,e=a.fetchData;h.initFormList(c),d.openConfirm({template:"createOne",controller:["$scope",function(a){a.fetchData=e,a.fieldsList=c,a.TitleText="新增工作组",a.formSubmit=function(){h.formSubmit(a,!0,a.fieldsList,g.upWorkflowgroup,null,null,b.pHeader)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},a.editItem=function(c){var e=a.fieldsList,f=a.fetchData;h.bindFormData(c,e),d.openConfirm({template:"createOne",controller:["$scope",function(a){a.fetchData=f,a.fieldsList=e,a.TitleText="编辑工作组",a.formSubmit=function(){h.formSubmit(a,!1,a.fieldsList,g.upWorkflowgroup,c,null,b.pHeader)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},a.deleteItem=function(c){f.checkone("删除操作",function(){h.deleteItem(a,g.deleteWorkflowgroup,c,b.pHeader)},function(){},"确定","取消",!0,!0,"确定要删除吗？")};var j=function(a,b){a.ngDialogPromise=c({method:"get",url:g.workflowGroupmembersbygid+"?gid="+b}).success(function(b){var c=b.State.Code,d=b.State.Message;0===c?a.Members=b.Content:f.autoclose(d)}).error(function(a){f.autoclose(h.errorResult(a))})},k=function(a,b,d,e,g){var i=h.getFormData(a.fieldsList);i=$.extend(!0,i,e),a.ngDialogPromise=c({headers:g,method:"post",url:b,data:i}).success(function(b){var c=b.State.Code,e=b.State.Message;0===c?(d(),a.closeThisDialog()):f.autoclose(e)}).error(function(a){f.autoclose(h.errorResult(a))})},l=function(a,b){b&&(a.getResidentPromise=c({method:"get",url:g.negotiationList+"?value="+b}).success(function(b){var c=b.State.Code,d=b.State.Message;0===c?(a.ResidentStatus=b.Content,a.ResidentStatus&&a.ResidentStatus.length>0?(a.ResidentStatus.forEach(function(a,b){a.Id=a.IdentityCode}),a.fieldsList[0].opts=a.ResidentStatus,a.fieldsList[0].value=a.ResidentStatus[0]?a.ResidentStatus[0].Id:""):f.autoclose("当前关键字没有相关居民，请重新搜索！")):f.autoclose(d)}).error(function(a){f.autoclose(h.errorResult(a))}))},m=function(a,c){var e=function(){a.getWorkGroupMembers(a,c)},f=[{name:"MemberId",nameDisplay:"选择成员",editor:"select",required:!0,value:0,originValue:"",opts:[{Id:0,Name:"请选择"}]}];d.openConfirm({template:"createOne",controller:["$scope",function(a){a.fieldsList=f,a.TitleText="新增组成员",a.Resident={},a.formSubmit=function(){var d={GroupId:c};k(a,g.inWorkflowgroupmember,e,d,b.pHeader)},a.getResidentStatus=function(){l(a,a.Resident.value)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})},n=function(a,d,e){a.ngDialogPromise=c({headers:b.pHeader,method:"delete",url:g.deleteWorkflowgroupmember+"?id="+d.Id}).success(function(b){var c=b.State.Code,d=b.State.Message;0===c?(f.autoclose("删除操作成功！"),a.getWorkGroupMembers(a,e)):f.autoclose(d)}).error(function(a){f.autoclose(h.errorResult(a))})};a.memberItem=function(b){var c=a.fieldsList,e=a.fetchData;h.bindFormData(b,c),d.openConfirm({template:"memberManage",controller:["$scope",function(a){a.fetchData=e,a.fieldsList=c,a.TitleText="成员管理",a.Members=[],a.memberList=[],a.getWorkGroupMembers=function(a,b){j(a,b)},0===a.Members.length&&a.getWorkGroupMembers(a,b.Id),a.createMember=function(){m(a,b.Id)},a.deleteMember=function(c){n(a,c,b.Id)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:600})}}]);