/*!qinglongWeb-1.0.0 2017-11-01*/
App.controller("acountsCtrl",["$scope","$rootScope","$http","ngDialog","PagerExtends","layerAlert","serverUrls","PcService",function(a,b,c,d,e,f,g,h){a.list=[],a.TitleText="新增",a.fetchData=function(){a.listBusyPromise=c({headers:b.gHeader,method:"get",url:g.userList}).success(function(b){var c=b.State.Code;b.State.Message;0===c&&(a.list=b.Content)}).error(function(a){f.autoclose(h.errorResult(a))})},a.fetchData();var i=function(a,d,e){a.ngDialogPromise=c({headers:b.gHeader,method:"get",url:g.userrolelist+"?name="+d.LoginName}).success(function(b){var c=b.State.Code;b.State.Message;0===c&&(a.allOwerList=b.Content,e&&a.allRolesList.forEach(function(b,c){b.HasThisRoles=!1,b.userRoleId=null,a.allOwerList.forEach(function(a,c){return b.Name===a.RoleName?(b.HasThisRoles=!0,void(b.userRoleId=a.Id)):void 0})}))}).error(function(a){f.autoclose(h.errorResult(a))})},j=function(a,d){a.ngDialogPromise=c({headers:b.gHeader,method:"get",url:g.getAllRole}).success(function(b){var c=b.State.Code;b.State.Message;0===c&&(a.allRolesList=b.Content,i(a,d,a.allRolesList))}).error(function(a){f.autoclose(h.errorResult(a))})},k=function(a,e,i,j,k){var l,m,n;switch(e.HasThisRoles){case!0:l=g.inUserrole,m="post",n={UserName:i,RoleCode:e.Code};break;case!1:if(!e.userRoleId){if(a.count===k-1)return f.autoclose("您未进行任务操作！"),a.fetchData(),void setTimeout(function(){d.closeAll()},1600);a.count++}l=g.deUserrole+"?id="+e.userRoleId,m="delete",n=null}a.ngDialogPromise=c({headers:b.pHeader,method:m,url:l,data:n}).success(function(b){b.State.Code,b.State.Message;j===k-1&&(f.autoclose("角色配置成功！"),a.fetchData(),setTimeout(function(){d.closeAll()},1500))}).error(function(a){f.autoclose(h.errorResult(a))})},l=function(a,b,c){var d=b.length;a.count=0,b.forEach(function(b,e){k(a,b,c,e,d)})};a.configureItem=function(b){var c=a.fetchData;d.openConfirm({template:"createOne",controller:["$scope",function(a){a.TitleText="配置角色",a.myRoles={},a.allOwerList=[],a.allRolesList=[],a.isSee=!1,a.fetchData=c,j(a,b),a.submitRoles=function(){l(a,a.allRolesList,b.LoginName)}}],className:"ngdialog-theme-default",closeByDocument:!1,width:850})},a.seeItem=function(a){d.openConfirm({template:"createOne",controller:["$scope",function(b){b.TitleText="查看角色",b.allOwerList=[],b.isSee=!0,b.allOwerList&&0!==b.allOwerList.length||i(b,a),b.submitRoles=function(){d.closeAll()}}],className:"ngdialog-theme-default",closeByDocument:!1,width:850})}}]);